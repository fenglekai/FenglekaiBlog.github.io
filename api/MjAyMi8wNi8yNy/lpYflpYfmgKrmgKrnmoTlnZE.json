{"title":"学习路上的坑","date":"2022-06-27T01:02:02.000Z","date_formatted":{"ll":"2022年6月27日","L":"2022/06/27","MM-DD":"06-27"},"thumbnail":"https://picsum.photos/1280/720?random=10","color":"#111","link":"2022/06/27/奇奇怪怪的坑","tags":["笔记"],"updated":"2023-02-13T07:34:07.829Z","content":"<h3 id=\"mockjs的坑\">mockjs的坑<a title=\"#mockjs的坑\" href=\"#mockjs的坑\"></a></h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在 node_modules/mockjs/dist/mock.js 中的 </span></span><br><span class=\"line\"><span class=\"comment\">// 如果未找到匹配的数据模板 上面加入以下代码 </span></span><br><span class=\"line\">MockXMLHttpRequest.prototype.upload = createNativeXMLHttpRequest().upload</span><br></pre></td></tr></table></figure>\n<p>原因是 Mockjs 中, 封装了原生的 XMLHttpRequest 为 MockXMLHttpRequest. 解决思路是, 把原生 XMLHttpRequest 的 upload 属性赋给 MockXMLHttpRequest 的原型对象</p>\n<p><strong>后来发现还是解决不了问题，最简单的办法还是删除mockjs依赖…</strong></p>\n<h3 id=\"command:--node-scripts/build.js\">command:  node scripts/build.js<a title=\"#command:--node-scripts/build.js\" href=\"#command:--node-scripts/build.js\"></a></h3>\n<p>主要是windows平台缺少编译环境，</p>\n<blockquote>\n<p>1、先运行： npm install -g node-gyp<br>\n2、然后运行：运行 npm install --global --production windows-build-tools</p>\n</blockquote>\n<p>可以自动安装跨平台的编译器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall node-sass</span><br><span class=\"line\">npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/</span><br></pre></td></tr></table></figure>\n<p>接着就可以</p>\n<blockquote>\n<p>npm install<br>\nnpm run dev</p>\n</blockquote>\n<h3 id=\"vite+vue3+ts-使用@别名的一些问题\">vite+vue3+ts 使用@别名的一些问题<a title=\"#vite+vue3+ts-使用@别名的一些问题\" href=\"#vite+vue3+ts-使用@别名的一些问题\"></a></h3>\n<p>首先需要在vite.config.js中配置</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  defineConfig</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vite&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> vue <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123;</span><br><span class=\"line\">  resolve</span><br><span class=\"line\">&#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> defineConfig(&#123;</span><br><span class=\"line\">  <span class=\"attr\">resolve</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">alias</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;@&#x27;</span>: resolve(__dirname, <span class=\"string\">&#x27;src&#x27;</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">extensions</span>: [<span class=\"string\">&quot;.js&quot;</span>, <span class=\"string\">&quot;.ts&quot;</span>, <span class=\"string\">&quot;.tsx&quot;</span>, <span class=\"string\">&quot;.jsx&quot;</span>]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [vue()]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>然后新建tsconfig.json配置</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">&quot;target&quot;</span>: <span class=\"string\">&quot;esnext&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;module&quot;</span>: <span class=\"string\">&quot;esnext&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;strict&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;jsx&quot;</span>: <span class=\"string\">&quot;preserve&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;importHelpers&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;moduleResolution&quot;</span>: <span class=\"string\">&quot;node&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;skipLibCheck&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;esModuleInterop&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;allowSyntheticDefaultImports&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;sourceMap&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;baseUrl&quot;</span>: <span class=\"string\">&quot;.&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;types&quot;</span>: [<span class=\"string\">&quot;vite/client&quot;</span>],</span><br><span class=\"line\">        <span class=\"attr\">&quot;paths&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;@/*&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;src/*&quot;</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">&quot;lib&quot;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&quot;esnext&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;dom&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;dom.iterable&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;scripthost&quot;</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">&quot;include&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;src/**/*.ts&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;src/**/*.tsx&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;src/**/*.vue&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;tests/**/*.ts&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;tests/**/*.tsx&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;typings&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">&quot;exclude&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;node_modules&quot;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"最后解决ts不能识别.vue文件的问题\">最后解决ts不能识别.vue文件的问题<a title=\"#最后解决ts不能识别.vue文件的问题\" href=\"#最后解决ts不能识别.vue文件的问题\"></a></h4>\n<p>根目录新建文件夹typings，新建文件shims-vue.d.ts</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"built_in\">module</span> <span class=\"string\">&#x27;*.vue&#x27;</span> &#123;<span class=\"comment\">// ts全局定义.vue文件判断</span></span><br><span class=\"line\">    <span class=\"keyword\">import</span> <span class=\"keyword\">type</span> &#123; DefineComponent &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> component: DefineComponent&lt;&#123;&#125;, &#123;&#125;, <span class=\"built_in\">any</span>&gt;</span><br><span class=\"line\">    <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> component</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"vite打包后访问白屏、跨域报错问题\">vite打包后访问白屏、跨域报错问题<a title=\"#vite打包后访问白屏、跨域报错问题\" href=\"#vite打包后访问白屏、跨域报错问题\"></a></h3>\n<p>在vite.config.js添加<code>base: './' </code></p>\n<p>来自<a href=\"https://forum.vuejs.org/t/vite-2-vue-3-index-html/113281/3\" target=\"_blank\">vue issues</a> <strong>silentdepth</strong>的回答：</p>\n<blockquote>\n<p>那我建议你换别的 bundler。Vite 没有为传统模块系统设计，ES Modules 是其特性基线。</p>\n<p>或者，你可以在原生应用注入自定义 scheme 来使用内嵌页面（<code>example-app://</code> 什么的），这样可以正常激活 ES Modules 特性，从一开始规避这个问题。</p>\n<p>如果你实在希望使用 Vite 做开发，同时只能使用 <code>file:///</code>，可以使用 <a href=\"https://github.com/vitejs/vite/tree/main/packages/plugin-legacy\" target=\"_blank\">@vitejs/plugin-legacy 39</a> 生成 nomodule 的版本，然后对 <code>dist/index.html</code> 做如下改动：</p>\n<ul>\n<li>移除 <code>&lt;script type=module&gt;</code> 元素</li>\n<li>移除其他 <code>&lt;script&gt;</code> 的 <code>nomodule</code> 属性</li>\n<li>移除 <code>&lt;script id=vite-legacy-entry&gt;</code> 元素的内容，并把 <code>data-src</code> 属性名改为 <code>src</code></li>\n<li>移除 SystemJS loader 代码（那个压缩到一行的 <code>&lt;script&gt;</code>）</li>\n<li>修改所有资源地址为相对地址（例如把 <code>/assets/index-legacy.xxxx.js</code> 改为 <code>./assets/index-legacy.xxxx.js</code>，注意还有 CSS 文件）</li>\n</ul>\n<p>我没有这么实践过，不确定所有功能都是正常的，建议部署前充分测试。</p>\n</blockquote>\n","prev":{"title":"前端文件上传与下载","link":"2022/06/27/前端文件上传与下载"},"next":{"title":"常用的工具软件","link":"2022/06/27/常用的工具软件"},"plink":"https://fenglekai.github.io/2022/06/27/奇奇怪怪的坑/","toc":[{"id":"mockjs的坑","title":"mockjs的坑","index":"1"},{"id":"command:--node-scripts/build.js","title":"command:  node scripts&#x2F;build.js","index":"2"},{"id":"vite+vue3+ts-使用@别名的一些问题","title":"vite+vue3+ts 使用@别名的一些问题","index":"3"},{"id":"vite打包后访问白屏、跨域报错问题","title":"vite打包后访问白屏、跨域报错问题","index":"4"}],"reading_time":"676 字约 5 分钟"}